@model LearnLangs.Models.Course

@{
    ViewData["Title"] = "Delete Course";
    // Ưu tiên ViewBag.HasLessons do controller đã set; fallback sang Model.Lessons
    bool hasLessons = (ViewBag.HasLessons as bool?) == true || (Model?.Lessons?.Any() ?? false);
}

<h1>Delete Course</h1>
<hr />

@if (TempData["CourseMsg"] != null)
{
    <div class="alert alert-warning">@TempData["CourseMsg"]</div>
}

@if (hasLessons)
{
    <div class="alert alert-danger">
        This course still has <strong>@(Model?.Lessons?.Count() ?? 0)</strong> lesson(s).
        You must remove these lessons before deleting this course.
    </div>

    @if (Model?.Lessons != null && Model.Lessons.Any())
    {
        <ul class="list-group mb-3">
            @foreach (var l in Model.Lessons.OrderBy(l => l.OrderIndex).ThenBy(l => l.Id))
            {
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>@l.Title</span>
                    <small class="text-muted">Order: @l.OrderIndex</small>
                </li>
            }
        </ul>
    }
}
else
{
    <p class="text-danger">Are you sure you want to delete this course?</p>
}

<dl class="row">
    <dt class="col-sm-2">@Html.DisplayNameFor(m => m.Name)</dt>
    <dd class="col-sm-10">@Html.DisplayFor(m => m.Name)</dd>

    <dt class="col-sm-2">@Html.DisplayNameFor(m => m.Description)</dt>
    <dd class="col-sm-10">@Html.DisplayFor(m => m.Description)</dd>
</dl>

<form asp-action="Delete" method="post" class="mt-2">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <button type="submit"
            class="btn btn-danger"
            disabled="@(hasLessons ? "disabled" : null)"
            title="@(hasLessons ? "Cannot delete course with lessons" : "Delete this course")">
        Delete
    </button>
    <a asp-action="Index" class="btn btn-secondary ms-2">Back to List</a>
</form>
